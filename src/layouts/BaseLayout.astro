---
import { ThemeToggle, ToasterHost } from "@/features/common";
import headImg from "../image_data/head.png";
import "../index.css";
import "../styles/custom.css";
import "../styles/animations.css";
---
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="color-scheme" content="light dark" />
    <link rel="icon" type="image/png" href={headImg.src} sizes="32x32" />
    <link rel="shortcut icon" type="image/png" href={headImg.src} />
    <link rel="apple-touch-icon" href={headImg.src} />
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" crossorigin="anonymous" onload="this.rel='stylesheet'" />
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" crossorigin="anonymous" /></noscript>
    <script>
      (() => {
        try {
          const el = document.documentElement;
          const saved = localStorage.getItem('theme');
          if (saved === 'dark') {
            el.classList.add('dark');
            el.classList.remove('light');
          } else if (saved === 'light') {
            el.classList.add('light');
            el.classList.remove('dark');
          } else {
            el.classList.add('light');
            el.classList.remove('dark');
          }
        } catch {}
      })();
    </script>
    <meta name="theme-color" content="#f9fafb" />
    <script>
      (() => {
        const m = document.querySelector('meta[name="theme-color"]');
        const set = () => m && m.setAttribute('content', document.documentElement.classList.contains('dark') ? '#111827' : '#f9fafb');
        set();
        new MutationObserver(set).observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });
      })();
    </script>
    <style>
      html.light, html.light body { background-color: #f9fafb; }
      html.dark, html.dark body { background-color: #111827; }
      .site-header { background-color: transparent; }
      html.light .site-header { background-color: rgba(255,255,255,0.70); }
      html.dark .site-header { background-color: rgba(17,24,39,0.70); }
    </style>
    <title>Gkin的博客</title>
  </head>
  <body class="text-gray-800 dark:text-white transition-colors duration-300 ease-in-out">
    <header class="site-header sticky top-0 z-30 border-b border-gray-200 dark:border-gray-800 backdrop-blur-md text-gray-900 dark:text-white transition-colors duration-300 ease-in-out">
      <div class="container mx-auto px-4 py-4 flex items-center justify-between">
        <a href="/" class="flex items-center gap-2 font-bold text-lg">
          <img
            id="site-logo"
            src={headImg.src}
            alt="头像"
            class="w-8 h-8 rounded-full object-cover ring-2 ring-blue-500/60 logo-spin"
          />
          <span>个人博客</span>
        </a>
        <nav class="flex items-center gap-6 text-sm">
          <a href={import.meta.env.BASE_URL} astro:prefetch class="hover:text-blue-600 dark:hover:text-blue-400">首页</a>
          <a href={`${import.meta.env.BASE_URL}articles`} astro:prefetch class="hover:text-blue-600 dark:hover:text-blue-400">文章</a>
          <a href={`${import.meta.env.BASE_URL}about`} astro:prefetch class="hover:text-blue-600 dark:hover:text-blue-400">关于</a>
          <!-- 历程与技能页面已并入关于页，移除导航入口 -->
          <a href={`${import.meta.env.BASE_URL}guestbook`} astro:prefetch class="hover:text-blue-600 dark:hover:text-blue-400">留言板</a>
          <!-- 仅在客户端渲染主题切换，避免SSR与客户端主题不一致导致的水合警告与图标错位 -->
          <ThemeToggle client:only="react" />
        </nav>
      </div>
    </header>
    <ToasterHost client:load />
    <main id="page-transition">
      <slot />
    </main>
    <script>
      // 允许用户点击 Logo 切换旋转/暂停
      (function () {
        const logo = document.getElementById('site-logo');
        if (logo) {
          logo.title = '点击暂停/恢复旋转';
          logo.style.cursor = 'pointer';
          logo.addEventListener('click', () => {
            logo.classList.toggle('logo-paused');
          });
        }
      })();
      // 页面进入时淡入，减少切换时的闪屏感
      (function () {
        const el = document.getElementById('page-transition');
        if (el) {
          requestAnimationFrame(() => {
            el.classList.add('page-transition-enter-active');
          });
        }
      })();
      
    </script>
  </body>
</html>
