---
import BaseLayout from "../layouts/BaseLayout.astro";
import GuestbookIsland from "../islands/GuestbookIsland.tsx";
import GuestbookHeaderIsland from "../islands/GuestbookHeaderIsland";
---
<BaseLayout>
  <Fragment slot="head">
    <title>留言板 - 个人博客</title>
  </Fragment>
  <section class="relative py-10 transition-colors duration-300">
    <div class="absolute inset-0 -z-10 bg-gradient-to-b from-transparent to-blue-500/6 dark:to-purple-500/10"></div>
    <div class="container mx-auto px-4">
      <GuestbookHeaderIsland client:visible />
      <GuestbookIsland client:load />
    <div class="mt-8 text-sm text-gray-500 dark:text-gray-400">
      <p>提示：如果你还没有配置 Supabase，请按照以下步骤操作：</p>
      <ol class="list-decimal ml-5 mt-2 space-y-1">
        <li>在 supabase.com 创建项目，获取 Project URL 与 anon key。</li>
        <li>在项目根目录创建 .env 文件，设置：PUBLIC_SUPABASE_URL 与 PUBLIC_SUPABASE_ANON_KEY。</li>
        <li>在 Supabase SQL 编辑器创建数据表：
          <pre class="mt-2 p-2 rounded bg-gray-100 dark:bg-gray-800 overflow-auto"><code>create table if not exists public.guestbook (
  id bigint generated by default as identity primary key,
  content text not null,
  author text,
  created_at timestamp with time zone default now()
);
alter table public.guestbook enable row level security;
create policy "Allow anonymous insert"
  on public.guestbook for insert
  to anon using (true) with check (true);
create policy "Allow anonymous read"
  on public.guestbook for select
  to anon using (true);
</code></pre>
        </li>
        <li>重启本地开发服务器（npm run dev），即可在此页面提交与查看留言。</li>
      </ol>
    </div>
    </div>
  </section>
</BaseLayout>
